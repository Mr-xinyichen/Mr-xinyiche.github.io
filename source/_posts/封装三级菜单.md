---
layout: posts
title: 封装三级菜单
date: 2020-03-17 09:16:35
updated: 2020-03-17 09:16:35
tags: 
categories: 
 - 经验&bug
---

## 适用于浅层级菜单，优点在于只需查询一次数据库。

### 实体类（也是最基本的底层分类菜单）
```java
@Data
public class PmsProductCategory implements Serializable {

    private static final long serialVersionUID = 1L;

    private Long id;
	
	...
}
```
### 需要返回的菜单类
```java
@Data
public class PmsProductCategoryWithChildrenItem extends PmsProductCategory  implements Serializable {

    private static final long serialVersionUID = 1L;

    private Long id;

	...
	
	//二级分类
	private List<PmsProductCategoryLevelTwo> children = new ArrayList<PmsProductCategoryLevelTwo>();
}
```

### 二级分类
```java
@Data
public class PmsProductCategoryLevelTwo implements Serializable {

    private static final long serialVersionUID = 1L;

    private Long id;
	
	...

	//三级分类
	private List<PmsProductCategory> children = new ArrayList<PmsProductCategory>();
}
```

### 实现菜单封装
```java
public List<PmsProductCategoryWithChildrenItem> listCatelogWithChilder(int i) {
    //最终要返回的集合
    List<PmsProductCategoryWithChildrenItem> dataList = new ArrayList<>();

    //存储一级分类
    Map<Long,PmsProductCategoryWithChildrenItem> mapOne = new HashMap<>();

    //存储二级分类
    Map<Long,PmsProductCategoryLevelTwo> mapTwo = new HashMap<>();

    //查询所有分类
    List<PmsProductCategory> selectList = productCategoryMapper.selectList(null);

    for (PmsProductCategory category : selectList) {
        if (category.getLevel()==0){  //一级分类
            PmsProductCategoryWithChildrenItem levelOne = new PmsProductCategoryWithChildrenItem();
            BeanUtils.copyProperties(category,levelOne);
            //存储一级分类
            mapOne.put(category.getId(),levelOne);
            //构造一级菜单
            dataList.add(levelOne);
        }
        else if(category.getLevel()==1){  //二级分类
            //获取当前分类的父级分类
            PmsProductCategoryWithChildrenItem parent = mapOne.get(category.getParentId());
            //获取对应的子级分类
            List<PmsProductCategoryLevelTwo> children = parent.getChildren();
            PmsProductCategoryLevelTwo levelTwo = new PmsProductCategoryLevelTwo();
            BeanUtils.copyProperties(category,levelTwo);
            children.add(levelTwo);
            //存储二级分类
            mapTwo.put(levelTwo.getId(),levelTwo);
            //构造二级菜单
            parent.setChildren(children);
        }
        else if(category.getLevel()==2){ //三级分类
            //获取当前分类的父级分类
            PmsProductCategoryLevelTwo parent = mapTwo.get(category.getParentId());
            //获取对应的子级分类
            List<PmsProductCategory> children = parent.getChildren();
            PmsProductCategory levelThree = new PmsProductCategory();
            BeanUtils.copyProperties(category,levelThree);
            //构造三级菜单
            children.add(levelThree);
        }
    }

    return dataList;
}
```