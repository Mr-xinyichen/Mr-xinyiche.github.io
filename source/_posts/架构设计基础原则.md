---
layout: posts
title: 架构设计基础原则
date: 2020-09-10 14:43:00
updated: 2020-09-10 14:44:17
tags: 
categories: 
 - 架构
---
####  需要考虑的架构设计问题：

- 云部署是大势所趋
- 企业对公有云能力的期待和公有云现有能力的差距
- 不能简单依赖公有云提供的SLA（service level agreement）来保障业务稳定性



####  云上设计高可用架构需要考虑的三大要素：

- 云基础设施和云服务器的高可用性

- 企业运行业务环境的高可用性

- 企业业务和客户端通信的高可用性（由运营商基础通信能力保障）

  

####  应用架构设计的演进之路：

**1.单体架构：**

- 经典的软件三层架构

- 逻辑上分为三层

- 多用于传统J2EE项目

  

![image.png](https://i.loli.net/2020/09/10/NWcZCo7y8nFvPKm.png)



**2.SOA（面向服务）架构：**

![EMKJRZ02H8LDPMETZ_KX_RB.png](https://i.loli.net/2020/09/10/J6AFCqYOgGuWHEp.png)



**微服务架构**：

![_7UKTZ@M145D3MIGBB7QJSO.png](https://i.loli.net/2020/09/10/1CjlxiSZntG72oK.png)



------

**基础架构设计原则：**

1. ####  墨菲定律（心理学效应）：

   - 任何事都没有看上去的那么简单

   - 所有事都会比预计的时间长

   - 会出错的事情总是会出错

   - 如果担心某件事的发生，这件事就更有可能发生

   

2. **容错设计原则**

3. **需要考虑到应用系统的每一个层面**

4. **消除单一故障点实现高可用性**

   

**云架构设计原则**

1. **从程序开发部署的视角看**

   - 系统失效的容错设计

     - 利用云原生容错的服务来增强业务的容错能力

   - 松耦合和无状态设计

     - 使用中间件解耦，无状态的应用能更好的伸缩
       - **无状态应用：** Stateless Application 是指并不会在会话中保存下次会话中去要的客户端数据。 每一个会话都像首次执行一样，不会依赖之前的数据进行响应。
       - **有状态的应用：** Stateful Application 是指会在会话中保存客户端的数据，并在客户端下一次的请求中来使用那些数据。

   - 可扩展和自动缩放设计

     - 利用云端的弹性伸缩机制来增加资源的灵活性

   - 安全的设计

     - 贯穿安全的的理念，减少不必要的暴露面

     

2. **从服务模块部署的视角看**

   - 高可用性（HA）、容灾和灾难恢复（DR）是不可忽略的两块内容
   - 高可用性的部署哟啊面向于将业务完全部署在云端的场景
   - 容灾和灾难恢复面向本地机房和云端业余打通的场景



**高可用架构设计原则：**

- 服务器级别的容错恢复
- 云服务区域级别的容错与恢复
- 云平台级别的容错与恢复
- 应用系统的**SOA**和服务化
- 使用云端工具构建自动化平台，用代码管理基础设施



**高可用（HA）场景：**

- 将应用程序设置为无状态，可通过重启进程或服务器恢复
- 将无状态的应用程序部署在负载均衡后面
- 设置弹性伸缩功能，使得云平台可以根据性能指标做出响应
- 设置好应用环境的基础镜像模板，便于快速恢复

**应用场景**：

1. 服务器级别的容错和恢复

   - 负载均衡节点的检查，当发现某个节点的健康出现问题时，剔除该节点

   ![image.png](https://i.loli.net/2020/09/10/6yv5ZaGfRjrK1ed.png)

2. 使用弹性伸缩功能快速调整集群

   - ops增加到阈值时根据提前定制的策略自动扩容
   - ops减小到阈值时根据提前定制的策略自动缩容

   ![image.png](https://i.loli.net/2020/09/10/SKPZWmhB2vtrzEY.png)

   ![image.png](https://i.loli.net/2020/09/10/ew7uL4JhpnXyavA.png)

3. 区域级别的容错和恢复

   - 某个区域服务器宕机时将业务迁移到其他区域服务器

   ![image.png](https://i.loli.net/2020/09/10/jK53lS7zqVENavP.png)

4. 多可用区部署的容错和恢复

   ![image.png](https://i.loli.net/2020/09/10/uq9XjdCLeRwKEmy.png)

